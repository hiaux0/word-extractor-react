var m=Object.defineProperty;var f=(r,e,t)=>e in r?m(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var c=(r,e,t)=>f(r,typeof e!="symbol"?e+"":e,t);function l(){return"xxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}class x{constructor(e){c(this,"items",[]);c(this,"defaultItem");c(this,"activeItemId");this.initialItems=e,e&&(e.forEach(t=>{t.id===void 0&&(t.id=l())}),this.items=e)}create(e,t={}){const s={id:l(),...this.initialItems,...e},{allowDuplicate:i,uniqueByKey:n}=t;if(i)return this.items.push(s),s;let o=-1;if(n&&(o=this.items.findIndex(d=>d[n]===s[n])),o!==-1)return;const u=this.items.findIndex(d=>d.id===s.id);return u!==-1?(this.items[u]=s,s):(this.items.push(s),s)}insertAt(e,t){const s=structuredClone(this.items);return s.splice(e,0,...t),s}batchCreate(e){this.items.push(...e)}readAll(e){return e?structuredClone(this.items):this.items}readBetween(e,t){const s=[];for(let i=e;i<=t;i++){const n=this.items[i];s.push(n)}return s}readById(e){return this.items.find(t=>t.id===e)}readByKey(e,t){return this.items.find(s=>s[e]===t)}readFirst(){return this.items.length===0?void 0:this.items[0]}readLast(){return this.items.length===0?void 0:this.items[this.items.length-1]}update(e){const t=this.items.findIndex(s=>s.id===e.id);t!==-1&&(this.items[t]=e)}batchUpdate(e){e.forEach(t=>{const s=this.items.findIndex(i=>i.id===t.id);s!==-1&&(this.items[s]=t)})}delete(e){console.log("[CRUDService.ts,123] this.items: ",this.items);const t=this.items.findIndex(s=>s.id===e);console.log("[CRUDService.ts,123] indexToDelete: ",t),t!==-1&&this.items.splice(t,1)}deleteByKey(e,t){this.items=this.items.filter(s=>s[e]!==t)}deleteBetween(e,t){const s=this.items.slice(0,e),i=this.items.slice(t+1,this.items.length);return[...s,...i]}batchDelete(e){this.items=this.items.filter(t=>!e.includes(t.id))}setActiveItem(e){this.activeItemId=e}getPreviousItem(e){const s=this.getCurrentItemIndex(e)-1,i=Math.max(s,0);return this.items[i]}getNextItem(e){const s=this.getCurrentItemIndex(e)+1,i=this.count()-1,n=Math.min(s,i);return this.items[n]}getCurrentItemIndex(e){return this.findIndexByKey("id",e)}count(){return this.items.length}clear(){this.items=[]}filterByKey(e,t){return this.items.filter(s=>s[e]===t)}findByKey(e,t){return this.items.find(s=>s[e]===t)}findIndexByKey(e,t){return this.items.findIndex(s=>s[e]===t)}replace(e){e&&(this.items=e)}replaceOne(e,t){console.log(">>>> _ >>>> ~ file: CRUDService.ts:203 ~ replace:",t);const s=structuredClone(this.items);return s[e]=t,s}sort(e,t=!0){this.items.sort((s,i)=>{const n=s[e],o=i[e];return n===o?0:t?n<o?-1:1:n>o?-1:1})}setDefault(e){this.defaultItem=e}}function h(){return new Promise((r,e)=>{const t=indexedDB.open("MyExtensionDB",1);t.onupgradeneeded=function(s){const i=s.target.result;i.objectStoreNames.contains("dataStore")||i.createObjectStore("dataStore",{keyPath:"id"})},t.onsuccess=function(s){r(s.target.result)},t.onerror=function(s){e(s.target.error)}})}function I(r){return new Promise((e,t)=>{const n=r.transaction("dataStore","readonly").objectStore("dataStore").get(1);n.onsuccess=function(o){e(o.target.result)},n.onerror=function(o){t("Error retrieving data: "+o.target.error)}})}browser.contextMenus.create({id:"collect-image",title:"Add to the collected images 2"});browser.browserAction.onClicked.addListener(()=>{console.log("[background.ts,28] addListener: "),browser.tabs.create({url:"dist/index.html"}),h().then(r=>{console.log("[CommunicationService.ts,59] db: ",r)}).then(()=>h()).then(r=>I(r)).then(r=>{console.log("Retrieved data:",r)}).catch(r=>{console.error("Error:",r)}),console.log("Extension background script is active.2")});const a=new x;browser.runtime.onMessage.addListener((r,e,t)=>{switch(r.action){case"create":a.create(r.entry),t({success:!0});break;case"read":const s=a.readAll();t({success:!0,entries:s});break;case"update":a.update(r.entry),t({success:!0});break;case"delete":a.delete(r.entryId),t({success:!0});break;default:t({error:"Unknown action"})}});
